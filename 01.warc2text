#!/bin/bash
set -euo pipefail

batch="$2"
output="$1/$(basename $batch)"

mkdir -p $output.$$

ls -l $batch/*.warc.gz > $output.$$/warc2text.log

warc2text \
	--tag-filters $SCRIPTS/mt-filter-list.annotated \
	--url-filters $SCRIPTS/url-filter-list.optimised \
	--output $output.$$ \
	--pdfpass $output.$$/pdf.warc.gz \
	--multilang \
	${WARC2TEXT_OPTIONS:-} \
	$batch/*.warc.gz \
	2> >(tee -a $output.$$/warc2text.log >&2)

mv $output.$$ $output

